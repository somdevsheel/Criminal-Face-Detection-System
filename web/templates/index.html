<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Criminal Face Detection System</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <header>
            <h1>üîç Criminal Face Detection & Recognition System</h1>
            <p class="subtitle">Advanced Face Recognition for Law Enforcement</p>
        </header>

        <div class="stats-bar" id="statsBar">
            <div class="stat-item">
                <span class="stat-label">Total Subjects:</span>
                <span class="stat-value" id="totalSubjects">0</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">Total Events:</span>
                <span class="stat-value" id="totalEvents">0</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">Recent Matches:</span>
                <span class="stat-value" id="recentMatches">0</span>
            </div>
        </div>

        <div class="tabs">
            <button class="tab-button active" onclick="openTab('recognize')">Recognize Face</button>
            <button class="tab-button" onclick="openTab('addSubject')">Add Subject</button>
            <button class="tab-button" onclick="openTab('viewSubjects')">View Subjects</button>
            <button class="tab-button" onclick="openTab('viewEvents')">View Events</button>
        </div>

        <!-- Recognition Tab -->
        <div id="recognize" class="tab-content active">
            <h2>Face Recognition</h2>
            <div class="card">
                <form id="recognizeForm">
                    <div class="form-group">
                        <label for="recognizeImage">Upload Image:</label>
                        <input type="file" id="recognizeImage" name="image" accept="image/*" required>
                        <div class="image-preview" id="recognizePreview"></div>
                    </div>
                    
                    <div class="form-group">
                        <label for="threshold">Similarity Threshold:</label>
                        <input type="range" id="threshold" name="threshold" min="0.3" max="0.9" step="0.05" value="0.4">
                        <span id="thresholdValue">0.40</span>
                    </div>
                    
                    <button type="submit" class="btn btn-primary">Recognize Faces</button>
                </form>
                
                <div id="recognizeResults" class="results"></div>
            </div>
        </div>

        <!-- Add Subject Tab -->
        <div id="addSubject" class="tab-content">
            <h2>Add New Subject</h2>
            <div class="card">
                <form id="addSubjectForm">
                    <div class="form-group">
                        <label for="subjectImage">Upload Image:</label>
                        <input type="file" id="subjectImage" name="image" accept="image/*" required>
                        <div class="image-preview" id="subjectPreview"></div>
                    </div>
                    
                    <div class="form-group">
                        <label for="subjectId">Subject ID:</label>
                        <input type="text" id="subjectId" name="subject_id" placeholder="e.g., CRIM001" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="subjectName">Name:</label>
                        <input type="text" id="subjectName" name="name" placeholder="Full Name" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="subjectCrime">Crime Description:</label>
                        <textarea id="subjectCrime" name="crime" rows="3" placeholder="Description of crime..." required></textarea>
                    </div>
                    
                    <button type="submit" class="btn btn-success">Add Subject</button>
                </form>
                
                <div id="addSubjectResults" class="results"></div>
            </div>
        </div>

        <!-- View Subjects Tab -->
        <div id="viewSubjects" class="tab-content">
            <h2>Database Subjects</h2>
            <div class="card">
                <div class="search-bar">
                    <input type="text" id="searchInput" placeholder="Search by name, ID, or crime...">
                    <button onclick="searchSubjects()" class="btn btn-secondary">Search</button>
                    <button onclick="loadSubjects()" class="btn btn-secondary">Show All</button>
                </div>
                
                <div id="subjectsList" class="subjects-list"></div>
            </div>
        </div>

        <!-- View Events Tab -->
        <div id="viewEvents" class="tab-content">
            <h2>System Events</h2>
            <div class="card">
                <div class="filter-bar">
                    <select id="eventTypeFilter">
                        <option value="">All Events</option>
                        <option value="MATCH">Matches</option>
                        <option value="NO_MATCH">No Matches</option>
                        <option value="ADD_SUBJECT">Added Subjects</option>
                        <option value="DELETE_SUBJECT">Deleted Subjects</option>
                    </select>
                    <button onclick="loadEvents()" class="btn btn-secondary">Refresh</button>
                </div>
                
                <div id="eventsList" class="events-list"></div>
            </div>
        </div>
    </div>

    <div id="loader" class="loader" style="display: none;">
        <div class="spinner"></div>
        <p>Processing...</p>
    </div>

    <script src="{{ url_for('static', filename='main.js') }}"></script>
</body>
</html>